# API обмена данных

## Введение

API обмена данных обеспечивает взаимодейстиве работы сайта с данными в базе MongoDB в виде ``json`` объектов запрос-ответ.

Основной принцип обращения к API

- **обращение по запросу** - только POST
- **url осуществления запросов** - ``http://my-site:3000/api`` (ведущая часть ``/api``)

Код запроса передается в теле ``POST`` запроса с дополнительными куками браузера ``key01``, ``key02`` и ``key03`` устанавливаемых после авторизации пользователя.

Если куки браузера не установлены, то API работает с запросами от имени гостевого входа и ограничивает свою работу.

Пример тела запроса:

``{cmd:"auth_user", args:{login:"user-login", password:"user-password"}}``

Где:
- ``cmd`` - основная команда API запроса
- ``args`` - аргументы запроса в виде ``json`` объекта (*{ключ:значение}*)

## СПИСОК КОМАНД И ИХ ОПИСАНИЕ

-------------------------------------------------------------------------------------------------------------------------------------------------------

### auth_user

Авторизация пользователя в системе. Если аргументы имеют пустой json объект ``{}``, то система попытается поднять пользователя из куков.

Аргументы:
- **login** - логин пользователя
- **password** - пароль для авторизации

Ответ:
``{result:{user_data}, error:{error_data}, messages:[messages_array]}``
Где:
- **user_data** - данные пользователя в формате json
- **error_data** - ошибка запроса авторизации (или null)
- **messages_array** - массив сообщений

**ДАННЫЕ ПОЛЬЗОВАТЕЛЯ** - ОТВЕТ:

```js
{
    _id: ObjectId(),
    login: "USER_LOGIN",
    password: "SHA256 КОД ЗАЩИЩЕННЫЙ КЛЮЧЕМ ДАННЫХ",
    access_level: 1000,
    email: "",
    telephone: "",
    active: true,
    activation_code: "",
    remember_code: "",
    email_active: false,
    email_code: "",
    info: "",
    session: { expires: new Date(), s_id: null }
}
```

-------------------------------------------------------------------------------------------------------------------------------------------------------

### exit_user

Выход пользователя.

Аргументов нет.

Ответ:
``{result:{}, error:null, messages:[{msg_type:"INFO", text:"Пользователь вышел из системы"}]}``


-------------------------------------------------------------------------------------------------------------------------------------------------------




